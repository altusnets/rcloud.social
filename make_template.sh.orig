# This script generates the Pandoc template file local.template
# and fills in the $body$ template variable when a file named
# 'body.html' exists in the local directory.
#
<<<<<<< HEAD
# The script operates in two phases.  In phase one the base template
# is selected via the following rule: If a file named template.html5
# exists in the local directory then it chooses this as the base
# template otherwise it uses html/template.html5.
=======
# The script operates in two phases.  In phase one the
# base template selected.  If a file named template.html5
# exists in the local directory then it chooses this
# as the base template otherwise it uses html/template.html5.
>>>>>>> fb5ae60ab8daf7c0b210fa7eda2da7595562c908
#
# In the second phase the script checks for the existence of a file
# named 'body.html' in the local directory.  If it exists then it
# replaces the $body$ template variable in the base template
# with the contents of 'body.html' and copies the result to
# local.template.  If 'body.html' does not exist then the
# base template is simplied copied to local.template.

if [ $# -ne 1 ]
then
    echo "Usage: make_template.sh <path>. "
    echo ""
    echo "Where <path> is the path to the 'html' folder containing the Pandoc template files."
else

    # if a file named 'template.html5' exists in the local directory
    # use it as the template source ...
    if [ -e template.html5 ]
    then
	SRC=template.html5
    else
	SRC=$1/html/template.html5 # ... otherwise use html/template.html5
    fi

    # if a file named 'body.html' exists in the local directory
    if [ -e body.html ]
    then
<<<<<<< HEAD
	OS=`uname`

	# escape the replacement target
	key=$(echo "\$body\$" | sed -e 's/[]\/$*.^|[]/\\&/g')

	if [ ${OS} = "Darwin" ]
	then

	    # replate $body$ with the contents of 'body.html'
	    sed -e "/${key}/r body.html" -e "/${key}/d" ${SRC} > local.template
	else
	    
	    # replate $body$ with the contents of 'body.html'
	    sed  -e "/${key}/{r body.html" -e "d}" ${SRC} > local.template
	fi
=======
	# escape the replacement target
	key=$(echo "\$body\$" | sed -e 's/[]\/$*.^|[]/\\&/g')

	# replate $body$ with the contents of 'body.html'
	sed  -e "/${key}/{r body.html" -e "d}" ${SRC} > local.template
	
>>>>>>> fb5ae60ab8daf7c0b210fa7eda2da7595562c908
    else
	cp ${SRC} local.template  # copy the template to local.template
    fi
    
fi
